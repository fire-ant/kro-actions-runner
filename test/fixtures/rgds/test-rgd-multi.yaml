# Additional RGDs for testing RGD discovery by labels
# These should NOT be selected by the kar binary when looking for
# scale-set-name: slapchop-linux-builders

---
apiVersion: kro.run/v1alpha1
kind: ResourceGraphDefinition
metadata:
  name: pod-runner-different-label
  labels:
    # Different scale set name - should NOT be discovered
    actions.github.com/scale-set-name: "different-scale-set"
spec:
  schema:
    apiVersion: v1alpha1
    kind: PodRunner
    spec:
      runnerName: string

  resources:
    - id: jitSecret
      externalRef:
        apiVersion: v1
        kind: Secret
        metadata:
          name: ${schema.spec.runnerName}

    - id: runnerPod
      readyWhen:
        - ${runnerPod.status.phase == "Running" || runnerPod.status.phase == "Succeeded" || runnerPod.status.phase == "Failed"}
      template:
        apiVersion: v1
        kind: Pod
        metadata:
          name: ${schema.spec.runnerName}-job
        spec:
          restartPolicy: Never
          containers:
            - name: runner
              image: busybox:latest
              command: ["/bin/sleep", "30"]
              env:
                - name: RUNNER_NAME
                  value: ${schema.spec.runnerName}

---
apiVersion: kro.run/v1alpha1
kind: ResourceGraphDefinition
metadata:
  name: pod-runner-no-label
  # No labels at all - should NOT be discovered
spec:
  schema:
    apiVersion: v1alpha1
    kind: PodRunner
    spec:
      runnerName: string

  resources:
    - id: jitSecret
      externalRef:
        apiVersion: v1
        kind: Secret
        metadata:
          name: ${schema.spec.runnerName}

    - id: runnerPod
      readyWhen:
        - ${runnerPod.status.phase == "Running" || runnerPod.status.phase == "Succeeded" || runnerPod.status.phase == "Failed"}
      template:
        apiVersion: v1
        kind: Pod
        metadata:
          name: ${schema.spec.runnerName}-job
        spec:
          restartPolicy: Never
          containers:
            - name: runner
              image: busybox:latest
              command: ["/bin/sleep", "30"]
              env:
                - name: RUNNER_NAME
                  value: ${schema.spec.runnerName}
